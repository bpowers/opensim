#===--- JIT compilation notes --------------------------------------------===#

I've always wanted to work with JIT compilation because of its possible
performance benefits and (from my point of view) elegance.  I had a
somewhat working backend a year ago, but it was fragile (didn't work on
windows, and worked differently on mac and linux).  My current work is
focusing on a robust JIT using LLVM, as well as a playground for my
object-oriented system dynamics ideas.


#===--- general outline --------------------------------------------------===#

- define data structures (see below)
- create function(s) to initialize constants
  - a 'new' function to get a new initialized simulation instance
  - an 'init' function to initialize the constants and stock initial
    values
- create simulate function (depends somewhat on RC4 or euler etc)
  - translate maths into llvm
- load in function to print sim structs (probably easiest to write it
  in C, and use clang or llvm-gcc to emit llvm bitcode)
- create a new sim struct and pass it to the simulate function


#===--- data-structure outline -------------------------------------------===#

struct data:
  uint32_t length
  real_t time
  ... other aux, stock and flow variables

struct sim:
  uint32_t length
  data *curr
  data *next
  ... other constant data and initial stock values


#===--- example ----------------------------------------------------------===#

struct _data_SIMNAME
{
  real_t time;
  real_t flow_1;
  real_t stock_1;
}

typedef struct _data_SIMNAME data_SIMNAME;


struct _sim_SIMNAME
{
  real_t const_1;
  real_t const_2;
  real_t stock_1_init;

  data_SIMNAME *curr;
  data_SIMNAME *next;
}

typedef struct _sim_SIMNAME (sim_SIMNAME *);


void init_SIMNAME (sim_SIMNAME *);

sim_SIMNAME *new_SIMNAME ()
{
  sim_SIMNAME *inst = malloc (sizeof (sim_SIMNAME));

  init_SIMNAME (inst);

  return inst;
}


void init_SIMNAME (sim_SIMNAME *self)
{
  // initializing constants should be seperate somehow
  self->const_1 = 45;
  ...
  self->stock_1_init = 5;

  self->curr = malloc (sizeof (sim_SIMNAME));
  self->next = malloc (sizeof (sim_SIMNAME));

  // initialize all the initial values of the stocks
  self->curr->stock_1 = self->stock_1_init;
}

